{
  "id": "playbook-builder",
  "scope": "builder",
  "title": "Builder ‚Äî √©diteur de site / WebSocket / drag & drop / widgets / configuration",
  "triggers": [
    "builder",
    "builder verrouill√©",
    "builder bloqu√©",
    "code personnalis√©",
    "couleur",
    "couleurs",
    "custom code",
    "drag drop",
    "editeur html",
    "√©diteur du site",
    "√©diteur visuel",
    "favicon",
    "formulaire",
    "glisser d√©poser",
    "iframe",
    "liens sociaux",
    "maintenance",
    "menu editor",
    "modifier le th√®me",
    "panneau de configuration",
    "personnaliser",
    "pr√©visualisation",
    "quelqu'un utilise le builder",
    "r√©seaux sociaux",
    "responsive",
    "sauvegarde",
    "section",
    "sections perdues",
    "style",
    "th√®me",
    "toolbar",
    "typographie",
    "verrouillage",
    "vue mobile",
    "vue tablette",
    "websocket",
    "widget",
    "widget produit"
  ],
  "steps": [
    {
      "kind": "solve",
      "response": "Le Builder est verrouill√© / en cours d'utilisation par quelqu'un d'autre :\n\nLe Builder utilise un syst√®me WebSocket de d√©tection de pr√©sence + verrouillage. Si un autre utilisateur (ou un ancien onglet) est connect√©, le builder passe en lecture seule.\n\n‚úì Solutions :\n  1. Demander √† l'autre personne de quitter le builder (fermer l'onglet)\n  2. Fermer TOUS vos onglets du dashboard TikTak ‚Üí rouvrir\n  3. Attendre 2-3 minutes (timeout WebSocket automatique)\n  4. Vider cache navigateur (Ctrl+Shift+Del) et se reconnecter\n  5. Essayer en navigation priv√©e\n\n‚ö†Ô∏è Le verrouillage est normal ‚Äî il prot√®ge contre les modifications simultan√©es et conflits de donn√©es.\n\nAvez-vous d'autres onglets du dashboard ouverts ? Quelqu'un d'autre a-t-il acc√®s au back-office ?",
      "actions": [
        "close_other_tabs",
        "wait_websocket_timeout",
        "clear_cache_reconnect"
      ],
      "success_indicator": "Builder d√©verrouill√©, √©dition possible",
      "step_id": "SOLVE_01_LE_BUILDER_EST_VER_B75372"
    },
    {
      "kind": "solve",
      "response": "Modifications non sauvegard√©es / donn√©es perdues :\n\nLe Builder sauvegarde automatiquement via un syst√®me d'√©v√©nements group√©s (batching + debounce). Les modifications sont mises en file d'attente puis envoy√©es au serveur en lot.\n\n‚úì Pourquoi des donn√©es peuvent √™tre perdues :\n  - Connexion internet coup√©e pendant l'√©dition\n  - Fermeture de l'onglet avant la fin du flush\n  - Perte de connexion WebSocket\n\n‚úì Solutions pr√©ventives :\n  1. Cliquer 'Sauvegarder' explicitement (Ctrl+S) avant de quitter\n  2. Attendre le spinner de sauvegarde termine avant de fermer\n  3. V√©rifier la stabilit√© de la connexion internet\n  4. Sauvegarder r√©guli√®rement (toutes les 2-3 modifications)\n\n‚úì R√©cup√©ration :\n  - Les donn√©es sauvegard√©es sont la derni√®re version confirm√©e par le serveur\n  - Pas de syst√®me d'historique/annulation √† ce stade ‚Üí toujours sauvegarder\n\n√Ä quel moment avez-vous perdu les modifications ? Avez-vous vu un message d'erreur ?",
      "actions": [
        "check_save_status",
        "verify_internet_connection",
        "reload_builder"
      ],
      "success_indicator": "Modifications correctement sauvegard√©es et visibles apr√®s rechargement",
      "step_id": "SOLVE_02_MODIFICATIONS_NON__3B7DF2"
    },
    {
      "kind": "solve",
      "response": "Drag & drop (glisser-d√©poser) ne fonctionne pas :\n\nLe Builder utilise DnD Kit (biblioth√®que React) pour le glisser-d√©poser des sections.\n\n‚úì Causes fr√©quentes et solutions :\n  1. Extension navigateur bloquante (ad-blocker, privacy tools)\n     ‚Üí D√©sactiver temporairement les extensions ou tester en navigation priv√©e\n  2. Navigateur obsol√®te\n     ‚Üí Mettre √† jour Chrome/Edge/Firefox (version r√©cente requise)\n  3. Appareil tactile (tablette/mobile)\n     ‚Üí Utiliser les boutons fl√®ches haut/bas au lieu du drag & drop\n  4. JavaScript d√©sactiv√© ou bloqu√©\n     ‚Üí V√©rifier les param√®tres du navigateur\n  5. Cache navigateur corrompu\n     ‚Üí Ctrl+Shift+Del ‚Üí vider cache et cookies ‚Üí recharger\n\n‚úì Alternative :\n  - Les boutons d'action sur chaque SectionCard permettent de r√©organiser avec 'Monter' / 'Descendre'\n\nQuel navigateur utilisez-vous ? Le probl√®me concerne la r√©organisation des sections ou l'ajout ?",
      "actions": [
        "test_incognito",
        "update_browser",
        "use_buttons_instead"
      ],
      "success_indicator": "Sections d√©pla√ßables par drag & drop ou boutons fl√®ches",
      "step_id": "SOLVE_03_DRAG_DROP_GLISSER__DD4ADB"
    },
    {
      "kind": "solve",
      "response": "Onglets de la sidebar du Builder :\n\nLa sidebar contient 10 onglets de configuration :\n\nüìã main-content ‚Äî Contenu principal (sections de la page)\nüîù navigation-header ‚Äî En-t√™te : logo, menu, barre de recherche\n‚¨áÔ∏è footer ‚Äî Pied de page : liens, colonnes, informations l√©gales\nüé® style-theme ‚Äî Style/Th√®me : couleurs, typographies, espacements\nüì± social-links ‚Äî R√©seaux sociaux : Facebook, Instagram, TikTok‚Ä¶\nüõí checkout ‚Äî Personnalisation page de paiement\nüîß maintenance ‚Äî Mode maintenance (site en construction)\nüîç seo ‚Äî SEO global : titres, meta, Open Graph\nüíª custom-code ‚Äî Code personnalis√© HTML/CSS/JS\nüêõ debug ‚Äî Diagnostic (mode avanc√©)\n\n‚ö†Ô∏è Certains onglets (Custom Code, Debug) n√©cessitent des permissions avanc√©es.\n\nQuel onglet cherchez-vous ou quel param√®tre voulez-vous modifier ?",
      "actions": [
        "navigate_sidebar_tab",
        "check_permissions"
      ],
      "success_indicator": "Onglet trouv√© et param√®tre modifi√©",
      "step_id": "SOLVE_04_ONGLETS_DE_LA_SIDE_DBE13F"
    },
    {
      "kind": "solve",
      "response": "Configurer les r√©seaux sociaux :\n\n‚úì √âtapes :\n  1. Ouvrir le Builder (√©diter une page)\n  2. Sidebar ‚Üí onglet 'R√©seaux sociaux' (social-links)\n  3. Remplir les URLs compl√®tes :\n     ‚Ä¢ Facebook : https://facebook.com/votrepage\n     ‚Ä¢ Instagram : https://instagram.com/votrepage\n     ‚Ä¢ TikTok : https://tiktok.com/@votrepage\n     ‚Ä¢ Twitter/X : https://twitter.com/votrepage\n     ‚Ä¢ YouTube : https://youtube.com/votrechaine\n  4. Sauvegarder\n\n‚úì O√π s'affichent-ils ?\n  - Dans le header et/ou footer du site (selon le template actif)\n  - Si non visibles : le template peut ne pas supporter l'affichage des ic√¥nes sociales\n\nVos liens ne s'affichent pas sur le site ? Quel template utilisez-vous ?",
      "actions": [
        "configure_social_links",
        "verify_template_support"
      ],
      "success_indicator": "Ic√¥nes r√©seaux sociaux visibles sur le site",
      "step_id": "SOLVE_05_CONFIGURER_LES_R_S_117E44"
    },
    {
      "kind": "solve",
      "response": "Modifier le th√®me / les couleurs du site :\n\n‚úì Via ThemeConfig (Sidebar ‚Üí Style/Th√®me) :\n  - Couleur principale (boutons, liens, accents)\n  - Couleur secondaire (arri√®re-plans, bordures)\n  - Typographies (police titre, police corps)\n  - Tailles de texte\n  - Espacements globaux\n  - Coins arrondis des boutons/cartes\n\n‚úì Processus :\n  1. Builder ‚Üí Sidebar ‚Üí 'Style/Th√®me'\n  2. Modifier les param√®tres souhait√©s\n  3. La pr√©visualisation se met √† jour en temps r√©el\n  4. Sauvegarder\n\n‚ö†Ô∏è Si les couleurs ne changent pas :\n  - Le template peut avoir des styles CSS prioritaires (en dur)\n  - Solution : onglet 'Custom Code' ‚Üí ajouter CSS avec !important\n  - Exemple : body { --primary-color: #FF5733 !important; }\n\nQuelles couleurs/styles voulez-vous modifier ?",
      "actions": [
        "open_theme_config",
        "modify_colors",
        "add_custom_css"
      ],
      "success_indicator": "Th√®me modifi√© et visible dans la pr√©visualisation + sur le site",
      "step_id": "SOLVE_06_MODIFIER_LE_TH_ME__4A106B"
    },
    {
      "kind": "solve",
      "response": "Types de widgets/sections disponibles dans le Builder :\n\nLe tiroir 'Ajouter une section' (AddSectionDrawer) propose ces types de champs :\n\nüìù Texte (TextFieldComponent) ‚Äî Titre, label, URL\nüìÑ Zone de texte (TextareaFieldComponent) ‚Äî Paragraphe, description\nüìã S√©lection (SelectFieldComponent) ‚Äî Menu d√©roulant d'options\n‚òëÔ∏è Cases √† cocher (CheckboxFieldComponent) ‚Äî Choix multiples\nüîò Interrupteur (BooleanFieldComponent) ‚Äî On/Off, toggle\nüñäÔ∏è √âditeur HTML (HtmlEditorFieldComponent) ‚Äî Contenu riche WYSIWYG\nüñºÔ∏è Image (ImageFieldComponent) ‚Äî Banni√®re, photo, logo\nüõçÔ∏è Widget Produits (ProductsWidgetFieldComponent) ‚Äî Grille/carrousel de produits\nüîó Widget Liens (LinkWidgetFieldComponent) ‚Äî Bouton CTA, liens\nüìä Widget Tableau (TableWidgetFieldComponent) ‚Äî Tableaux de donn√©es\n‚ÜîÔ∏è Alignement (AlignFieldComponents) ‚Äî Position gauche/centre/droite\n\nQuel type de section/widget cherchez-vous ou quel widget pose probl√®me ?",
      "actions": [
        "add_section",
        "configure_widget",
        "troubleshoot_widget"
      ],
      "success_indicator": "Widget ajout√© et correctement configur√©",
      "step_id": "SOLVE_07_TYPES_DE_WIDGETS_S_F0D599"
    },
    {
      "kind": "solve",
      "response": "Mode maintenance (site en construction) :\n\n‚úì Activer :\n  1. Builder ‚Üí Sidebar ‚Üí onglet 'Maintenance'\n  2. Activer le mode maintenance (toggle On)\n  3. Personnaliser le message affich√© aux visiteurs\n  4. Sauvegarder\n\n‚úì R√©sultat :\n  - Les visiteurs voient une page 'Site en construction'\n  - Les administrateurs connect√©s voient le site normalement\n  - Utile pendant les gros changements de template/contenu\n\n‚úì D√©sactiver :\n  - Retourner dans l'onglet Maintenance et d√©sactiver le toggle\n\nVoulez-vous activer ou d√©sactiver le mode maintenance ?",
      "actions": [
        "toggle_maintenance_mode"
      ],
      "success_indicator": "Mode maintenance activ√©/d√©sactiv√© selon besoin",
      "step_id": "SOLVE_08_MODE_MAINTENANCE_S_64FE2B"
    },
    {
      "kind": "solve",
      "response": "Code personnalis√© (Custom Code) :\n\n‚úì Acc√®s : Builder ‚Üí Sidebar ‚Üí onglet 'Code personnalis√©'\n\n‚úì Zones d'injection :\n  - Header : Code ajout√© dans le <head> (CSS, tracking, meta tags)\n  - Footer : Code ajout√© avant </body> (JS, analytics, chat widgets)\n\n‚úì Cas d'usage fr√©quents :\n  - Google Analytics / GTM : coller le script dans Header\n  - Facebook Pixel : coller dans Header\n  - CSS personnalis√© : ajouter dans Header entre <style>...</style>\n  - Chat Tawk.to / Crisp : coller dans Footer\n\n‚ö†Ô∏è Attention :\n  - Un mauvais code peut casser l'affichage du site\n  - Testez en pr√©visualisation avant de publier\n  - Cet onglet n√©cessite des permissions avanc√©es\n\nQuel type de code voulez-vous ajouter ?",
      "actions": [
        "add_header_code",
        "add_footer_code"
      ],
      "success_indicator": "Code inject√© et fonctionnel sur le site",
      "step_id": "SOLVE_09_CODE_PERSONNALIS_C_3CCDC7"
    },
    {
      "kind": "solve",
      "response": "Pr√©visualisation responsive (Desktop / Tablette / Mobile) :\n\n‚úì Utiliser le View Mode Toggle dans la toolbar du Builder :\n  - üñ•Ô∏è Desktop : largeur pleine\n  - üì± Tablette : largeur ~768px\n  - üì± Mobile : largeur ~375px\n\n‚úì L'iframe de pr√©visualisation s'adapte en temps r√©el.\n\n‚úì Si la pr√©visualisation est blanche / ne charge pas :\n  1. Ctrl+F5 pour recharger\n  2. V√©rifier console navigateur (F12) pour erreurs JS\n  3. Retirer la derni√®re section ajout√©e\n  4. Tester en navigation priv√©e\n  5. Si persiste : changer de template temporairement\n\n‚úì Pour une pr√©visualisation compl√®te :\n  - Cliquer 'Pr√©visualiser' ‚Üí ouvre le site dans un nouvel onglet\n\nLa pr√©visualisation ne fonctionne pas ou vous voulez juste tester le responsive ?",
      "actions": [
        "toggle_view_mode",
        "open_full_preview"
      ],
      "success_indicator": "Pr√©visualisation affich√©e dans le mode souhait√©",
      "step_id": "SOLVE_10_PR_VISUALISATION_R_B50DEE"
    },
    {
      "kind": "solve",
      "response": "Configurer le menu de navigation (MenuEditor) :\n\n‚úì Acc√®s : Builder ‚Üí Sidebar ‚Üí onglet 'Navigation/Header'\n\n‚úì Fonctionnalit√©s du MenuEditor :\n  - Ajouter un √©l√©ment au menu (page, cat√©gorie, lien externe)\n  - R√©organiser les √©l√©ments par glisser-d√©poser\n  - Cr√©er des sous-menus (√©l√©ments enfants)\n  - Supprimer des √©l√©ments\n  - Modifier le texte affich√© et l'URL/page li√©e\n\n‚úì Types d'√©l√©ments :\n  - Pages du site (Accueil, √Ä propos, FAQ‚Ä¶)\n  - Cat√©gories de produits\n  - Liens externes (URL personnalis√©e)\n\n‚úì Apr√®s modification :\n  1. Sauvegarder dans le MenuEditor\n  2. Sauvegarder/publier le Builder\n  3. Vider cache navigateur pour voir le r√©sultat\n\nQuel √©l√©ment voulez-vous ajouter/modifier dans le menu ?",
      "actions": [
        "open_menu_editor",
        "add_menu_item",
        "reorder_menu"
      ],
      "success_indicator": "Menu de navigation mis √† jour sur le site",
      "step_id": "SOLVE_11_CONFIGURER_LE_MENU_3DA46C"
    },
    {
      "kind": "verify",
      "question": "Apr√®s ces √©tapes, le probl√®me est-il r√©solu ? Si non, d√©crivez ce qui se passe et envoyez une capture d'√©cran.",
      "step_id": "VERIFY_12_APR_S_CES_TAPES_LE_E93D46"
    },
    {
      "kind": "escalate",
      "reason": "Builder reste verrouill√© apr√®s 10+ minutes et toutes les solutions tent√©es, OU donn√©es perdues de fa√ßon r√©p√©t√©e, OU bug technique emp√™chant l'√©dition",
      "required_info": [
        "URL du dashboard / page en cours d'√©dition",
        "Capture d'√©cran du builder (message d'erreur visible)",
        "Capture de la console navigateur (F12 ‚Üí Console)",
        "Navigateur + version",
        "Actions effectu√©es avant le probl√®me",
        "Template utilis√©",
        "Combien d'utilisateurs ont acc√®s au back-office"
      ],
      "step_id": "ESCALATE_13_ESCALATE_2F6581",
      "when": [
        "needs_human_review"
      ],
      "handoff_template": {
        "summary": "Builder reste verrouill√© apr√®s 10+ minutes et toutes les solutions tent√©es, OU donn√©es perdues de fa√ßon r√©p√©t√©e, OU bug technique emp√™chant l'√©dition",
        "repro_steps": [],
        "evidence": [
          "URL du dashboard / page en cours d'√©dition",
          "Capture d'√©cran du builder (message d'erreur visible)",
          "Capture de la console navigateur (F12 ‚Üí Console)",
          "Navigateur + version",
          "Actions effectu√©es avant le probl√®me",
          "Template utilis√©",
          "Combien d'utilisateurs ont acc√®s au back-office"
        ],
        "suspected_component": "builder",
        "priority": "P2"
      }
    }
  ],
  "related_docs": [
    "/content-management - Builder / √âditeur de site",
    "Architecture Builder : SectionsContext, useBuilderWebSocket, PageContentBuilder, FormViewer",
    "Sidebar : 10 onglets (contenu, navigation, footer, th√®me, social, checkout, maintenance, SEO, custom-code, debug)",
    "DnD Kit pour le glisser-d√©poser des sections"
  ],
  "common_workflows": [
    "Acc√®s Builder ‚Üí Ajout sections ‚Üí Configuration FormViewer ‚Üí Drag & drop r√©org ‚Üí Pr√©visualisation ‚Üí Sauvegarder",
    "Sidebar ‚Üí Navigation/Header ‚Üí MenuEditor ‚Üí Ajouter/r√©organiser √©l√©ments ‚Üí Sauvegarder",
    "Sidebar ‚Üí Style/Th√®me ‚Üí ThemeConfig ‚Üí Couleurs/typo ‚Üí Sauvegarder",
    "Sidebar ‚Üí R√©seaux sociaux ‚Üí SocialMediaConfig ‚Üí URLs ‚Üí Sauvegarder",
    "Sidebar ‚Üí Custom Code ‚Üí Ajouter tracking/CSS ‚Üí Pr√©visualiser ‚Üí Sauvegarder"
  ],
  "common_errors": [
    {
      "symptom": "Builder verrouill√© / en cours d'utilisation",
      "cause": "Autre utilisateur ou onglet avec session WebSocket active",
      "solution": "Fermer tous les onglets, attendre 2-3 min timeout, vider cache et reconnecter"
    },
    {
      "symptom": "Modifications perdues / non sauvegard√©es",
      "cause": "Perte connexion WebSocket, fermeture avant flush batching",
      "solution": "Sauvegarder explicitement (Ctrl+S), v√©rifier connexion internet, attendre fin du spinner"
    },
    {
      "symptom": "Drag & drop ne fonctionne pas",
      "cause": "Extension bloquante, navigateur obsol√®te, appareil tactile",
      "solution": "Navigation priv√©e, mettre √† jour navigateur, utiliser boutons fl√®ches √† la place"
    },
    {
      "symptom": "Iframe pr√©visualisation blanche",
      "cause": "Erreur JS dans sections, template corrompu",
      "solution": "Ctrl+F5, retirer derni√®re section, v√©rifier console F12, tester autre template"
    },
    {
      "symptom": "Widget produits vide",
      "cause": "Aucun produit s√©lectionn√© dans ProductsWidgetFieldComponent",
      "solution": "Cliquer sur la section ‚Üí ProductDrawer ‚Üí s√©lectionner des produits"
    },
    {
      "symptom": "√âditeur HTML ne fonctionne pas",
      "cause": "Conflit JavaScript ou navigateur incompatible",
      "solution": "Essayer Chrome/Edge r√©cent, navigation priv√©e, vider cache"
    },
    {
      "symptom": "Liens sociaux non visibles sur le site",
      "cause": "URLs non renseign√©es ou template sans support social",
      "solution": "SocialMediaConfig ‚Üí remplir URLs compl√®tes, v√©rifier compatibilit√© template"
    },
    {
      "symptom": "Couleurs/th√®me ne s'appliquent pas",
      "cause": "Template avec CSS prioritaire",
      "solution": "ThemeConfig, ou Custom Code avec CSS !important"
    },
    {
      "symptom": "Menu navigation ne se met pas √† jour",
      "cause": "MenuEditor non sauvegard√© ou cache",
      "solution": "Sauvegarder MenuEditor + builder, Ctrl+F5, navigation priv√©e"
    },
    {
      "symptom": "Onglet Custom Code / Debug manquant",
      "cause": "Permissions insuffisantes",
      "solution": "Contacter admin pour activer les permissions avanc√©es"
    },
    {
      "symptom": "Erreur √† l'ajout de section",
      "cause": "Limite sections atteinte ou incompatibilit√© template",
      "solution": "V√©rifier nombre max sections, essayer autre type, recharger builder"
    },
    {
      "symptom": "Mode maintenance ne se d√©sactive pas",
      "cause": "Toggle non sauvegard√© ou cache CDN",
      "solution": "D√©sactiver toggle + sauvegarder + attendre 2 min propagation CDN"
    }
  ],
  "best_practices": [
    "Sauvegarder explicitement (Ctrl+S) apr√®s chaque modification importante",
    "Ne pas ouvrir le builder dans plusieurs onglets simultan√©ment",
    "Pr√©visualiser en Desktop + Mobile avant de publier",
    "Ajouter les sections une par une et tester apr√®s chaque ajout",
    "Tester le code personnalis√© en pr√©visualisation avant de publier",
    "Toujours v√©rifier la console navigateur (F12) en cas de probl√®me",
    "Activer le mode maintenance pendant les gros changements"
  ],
  "canonical_scope": "builder",
  "required_fields": [
    {
      "key": "action",
      "question": "Que voulez-vous faire dans le builder (ajouter section, modifier th√®me, configurer menu, autre) ?"
    },
    {
      "key": "problem",
      "question": "Quel probl√®me rencontrez-vous (verrouillage, drag&drop, sauvegarde, affichage) ?"
    },
    {
      "key": "browser",
      "question": "Quel navigateur utilisez-vous ?"
    }
  ],
  "schema_version": "v2_deterministic_steps"
}