{
  "id": "playbook-coupons",
  "scope": "orders",
  "title": "Coupons ‚Äî cr√©ation / application / restrictions / affiliation",
  "triggers": [
    "affiliation",
    "bon",
    "code promo",
    "code r√©p√©titif",
    "code unique",
    "coupon",
    "coupon expir√©",
    "coupon invalide",
    "discount",
    "promo",
    "remise automatique",
    "r√©duction"
  ],
  "steps": [
    {
      "kind": "solve",
      "response": "Cr√©er un coupon (/coupons) :\n‚Ä¢ Coupons ‚Üí 'Nouveau coupon'\n‚Ä¢ Renseignez Nom du coupon* et Code* (ou cliquez 'G√©n√©rer' pour code al√©atoire)\n‚Ä¢ D√©finissez Montant de r√©duction* et Type* (Pourcentage % ou Montant fixe)\n‚Ä¢ Choisissez Type de coupon* :\n  - Code unique : usage cibl√©, g√©n√©r√© al√©atoirement\n  - Code r√©p√©titif : m√™me code pour plusieurs clients (ex: SUMMER10)\n  - Remise automatique : appliqu√©e quand conditions remplies (sans saisie code)\n‚Ä¢ D√©finissez p√©riode validit√© (dates d√©but/fin) ou 'Toujours actif'\n‚Ä¢ Activez options : Coupon actif, Disponible site web, Disponible back-office, Usage unique par client\n‚Ä¢ Enregistrez\n\nQuel code promo voulez-vous cr√©er, pour quelles dates et quel type (unique/r√©p√©titif/auto) ?",
      "actions": [
        "create_coupon"
      ],
      "success_indicator": "Coupon cr√©√© et visible dans la liste avec statut actif",
      "common_errors": [
        "Code d√©j√† utilis√© ‚Üí choisir un code unique",
        "Montant ou type manquant ‚Üí champs requis",
        "Dates incoh√©rentes ‚Üí date fin avant date d√©but"
      ],
      "step_id": "SOLVE_01_CR_ER_UN_COUPON_CO_7FA39A"
    },
    {
      "kind": "solve",
      "response": "Conditions d'application du coupon :\n‚Ä¢ Dans 'Conditions d'application', ajoutez des r√®gles :\n  - Valeur d'achat minimum (ex: ‚â• 100 DT)\n  - Cat√©gories sp√©cifiques (ex: Femme, √âlectronique)\n  - Produits sp√©cifiques\n  - Nombre d'articles minimum\n  - Transporteur sp√©cifique\n  - Nouveau client uniquement\n  - Client existant uniquement\n‚Ä¢ Empilez plusieurs conditions (toutes doivent √™tre respect√©es en m√™me temps)\n‚Ä¢ Option 'Tous les produits' : d√©sactivez pour cibler produits/cat√©gories sp√©cifiques\n‚Ä¢ Sauvegardez\n\nQuelles conditions voulez-vous appliquer (montant min, cat√©gorie, produit, autre) ?",
      "actions": [
        "set_coupon_conditions",
        "target_products_categories"
      ],
      "success_indicator": "Remise appliqu√©e uniquement quand toutes les conditions sont remplies",
      "step_id": "SOLVE_02_CONDITIONS_D_APPLI_5D2446"
    },
    {
      "kind": "solve",
      "response": "Coupon ne s'applique pas au panier :\n‚úì V√©rifiez statut : 'Coupon actif' = Oui, 'Disponible sur le site web' = Oui\n‚úì V√©rifiez dates (d√©but/fin) ‚Üí coupon doit √™tre dans la p√©riode valide\n‚úì V√©rifiez conditions d'application :\n  - Montant minimum panier atteint ?\n  - Produits/cat√©gories √©ligibles dans le panier ?\n  - Usage unique d√©j√† consomm√© par ce client ?\n‚úì V√©rifiez que le code est saisi EXACTEMENT (sensible √† la casse, pas d'espaces)\n‚úì Testez avec un panier conforme aux conditions\n\nQuel message exact s'affiche au checkout ? Le panier remplit-il les conditions (montant, produits) ?",
      "actions": [
        "coupon_not_applied",
        "verify_coupon_conditions",
        "check_usage_history"
      ],
      "success_indicator": "Coupon appliqu√© et r√©duction visible dans le panier",
      "common_reasons": [
        "Coupon inactif ou expir√©",
        "Conditions non remplies (montant/produits/cat√©gories)",
        "Usage unique d√©j√† consomm√©",
        "Code mal saisi (casse/espaces)"
      ],
      "step_id": "SOLVE_03_COUPON_NE_S_APPLIQ_3CB289"
    },
    {
      "kind": "solve",
      "response": "Coupon 'expir√©' ou 'invalide' :\n‚úì Confirmez l'orthographe EXACTE du code (majuscules/minuscules/tirets)\n‚úì V√©rifiez la timezone et date de fin (peut expirer √† minuit selon fuseau horaire)\n‚úì V√©rifiez que la p√©riode de validit√© est correcte\n‚úì D√©sactivez puis r√©activez le coupon\n‚úì √âtendez la date de fin si n√©cessaire\n‚úì Testez en back-office d'abord pour isoler le probl√®me\n\nPouvez-vous envoyer une capture des param√®tres du coupon (dates, statuts, conditions) ?",
      "actions": [
        "coupon_validate",
        "extend_validity_period",
        "test_in_backoffice"
      ],
      "success_indicator": "Coupon accept√© et appliqu√© correctement",
      "step_id": "SOLVE_04_COUPON_EXPIR_OU_IN_61B4C4"
    },
    {
      "kind": "solve",
      "response": "Affiliation & message automatique :\n‚Ä¢ Partagez l'URL de votre site avec le code dans le lien : `?coupon=VOTRECODE`\n  Exemple : https://votresite.com?coupon=SUMMER10\n‚Ä¢ Configurez le 'Texte d'affichage' dans la fiche coupon (ex: 'üåü Offre -10% sur tous les articles')\n‚Ä¢ Activez 'Disponible sur le site web'\n‚Ä¢ Le message s'affiche automatiquement quand le visiteur arrive via ce lien\n‚Ä¢ La remise se pr√©-applique si les conditions sont remplies\n‚Ä¢ V√©rifiez l'affichage sur la boutique\n\nVoulez-vous un code pour affiliation ou un message promo automatique ?",
      "actions": [
        "configure_affiliation_link",
        "set_promo_message",
        "test_affiliation_display"
      ],
      "success_indicator": "Message affich√© sur le site quand code pr√©sent dans URL, remise pr√©-appliqu√©e",
      "step_id": "SOLVE_05_AFFILIATION_MESSAG_A0F03B"
    },
    {
      "kind": "solve",
      "response": "Gestion et rapports coupons :\n‚Ä¢ Recherche par nom ou code\n‚Ä¢ Activez/d√©sactivez via le switch dans la liste (sans supprimer)\n‚Ä¢ √âditez ‚úé pour modifier param√®tres\n‚Ä¢ Supprimez üóëÔ∏è si plus utilis√©\n‚Ä¢ Consultez les m√©triques en haut :\n  - Total coupons\n  - Coupons actifs\n  - Utilisations total\n  - Revenus g√©n√©r√©s\n‚Ä¢ Filtrez par p√©riode pour analyser les performances\n\nVoulez-vous voir les performances d'un coupon sp√©cifique ou une analyse globale ?",
      "actions": [
        "view_coupon_metrics",
        "filter_by_period",
        "analyze_performance"
      ],
      "success_indicator": "M√©triques √† jour et coh√©rentes avec les ventes",
      "step_id": "SOLVE_06_GESTION_ET_RAPPORT_3AFDD3"
    },
    {
      "kind": "escalate",
      "reason": "Coupon actif avec bonnes conditions mais ne s'applique pas apr√®s tous les tests, ou incoh√©rence dans les m√©triques",
      "required_info": [
        "Code du coupon",
        "Capture param√®tres complets (dates, conditions, statuts, type)",
        "Capture erreur au checkout c√¥t√© client",
        "URL concern√©e",
        "D√©tails du panier de test (montant, produits)",
        "Historique d'utilisation si applicable",
        "Navigateur client"
      ],
      "step_id": "ESCALATE_07_ESCALATE_21D236",
      "when": [
        "needs_human_review"
      ],
      "handoff_template": {
        "summary": "Coupon actif avec bonnes conditions mais ne s'applique pas apr√®s tous les tests, ou incoh√©rence dans les m√©triques",
        "repro_steps": [],
        "evidence": [
          "Code du coupon",
          "Capture param√®tres complets (dates, conditions, statuts, type)",
          "Capture erreur au checkout c√¥t√© client",
          "URL concern√©e",
          "D√©tails du panier de test (montant, produits)",
          "Historique d'utilisation si applicable",
          "Navigateur client"
        ],
        "suspected_component": "orders",
        "priority": "P2"
      }
    },
    {
      "kind": "verify",
      "question": "Apr√®s ces √©tapes, est-ce que √ßa a march√© ? Si non, envoyez une capture + le message exact.",
      "step_id": "VERIFY_08_APR_S_CES_TAPES_ES_02B92D"
    },
    {
      "kind": "escalate",
      "question": "Pour escalader : code coupon + capture param√®tres complets + capture erreur checkout + d√©tails panier test + URL.",
      "escalation_payload_keys": [
        "module",
        "summary",
        "steps_tried",
        "evidence",
        "impact"
      ],
      "step_id": "ESCALATE_09_POUR_ESCALADER_COD_1FD100",
      "when": [
        "needs_human_review"
      ],
      "handoff_template": {
        "summary": "Escalade requise pour Coupons ‚Äî cr√©ation / application / restrictions / affiliation",
        "repro_steps": [],
        "evidence": [
          "checkout_url",
          "payment_method",
          "error_message"
        ],
        "suspected_component": "orders",
        "priority": "P2"
      }
    }
  ],
  "related_docs": [
    "/coupons - Module de gestion des coupons",
    "Types : Code unique, Code r√©p√©titif, Remise automatique",
    "Conditions : montant, cat√©gories, produits, transporteur, type client",
    "Affiliation : lien ?coupon=CODE avec message automatique"
  ],
  "common_workflows": [
    "Cr√©ation code promo standard ‚Üí d√©finition conditions ‚Üí activation ‚Üí partage",
    "Cr√©ation remise automatique ‚Üí conditions panier ‚Üí activation ‚Üí clients √©ligibles re√ßoivent automatiquement",
    "Affiliation ‚Üí cr√©ation code unique ‚Üí lien ?coupon=CODE ‚Üí tracking utilisations ‚Üí revenus"
  ],
  "best_practices": [
    "Testez TOUJOURS le coupon en back-office avant de le partager",
    "Utilisez des codes courts et m√©morables pour les codes r√©p√©titifs",
    "D√©finissez des dates de fin pour cr√©er l'urgence",
    "Utilisez les remises automatiques pour fid√©liser (ex: -10% si panier >200 DT)",
    "Suivez les m√©triques pour optimiser vos campagnes",
    "Usage unique par client pour √©viter les abus sur les codes g√©n√©reux"
  ],
  "canonical_scope": "checkout",
  "required_fields": [
    {
      "key": "checkout_url",
      "question": "Quelle est l‚ÄôURL de checkout ?"
    },
    {
      "key": "payment_method",
      "question": "Quelle m√©thode de paiement ?"
    },
    {
      "key": "error_message",
      "question": "Quel message/code exact ?"
    }
  ],
  "schema_version": "v2_deterministic_steps"
}