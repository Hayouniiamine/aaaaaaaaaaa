{
  "id": "playbook-email-notifications",
  "scope": "settings",
  "title": "Email & Notifications ‚Äî SMTP / Spam / Templates / Livraison",
  "triggers": [
    "email",
    "mail",
    "notification",
    "smtp",
    "spam",
    "courrier",
    "confirmation",
    "ne re√ßoit pas",
    "not receiving",
    "boite",
    "inbox",
    "noreply"
  ],
  "description": "Diagnostic et r√©solution des probl√®mes d'emails: configuration SMTP, emails en spam, templates cass√©s, notifications non re√ßues (commande, exp√©dition, mot de passe).",
  "steps": [
    {
      "kind": "ask",
      "question": "Email / Notifications : (1) Quel type d'email n'est pas re√ßu (confirmation commande / exp√©dition / mot de passe / autre) ? (2) L'email arrive-t-il en SPAM ? (3) Utilisez-vous un domaine personnalis√© (@votreentreprise.com) ?",
      "step_id": "ASK_01_EMAIL_NOTIFICATION_B2C881",
      "field": "email_type"
    },
    {
      "kind": "solve",
      "title": "V√©rifier l'adresse email dans le compte client",
      "response": "Premi√®re v√©rification c√¥t√© TikTak PRO :\n\n‚úì 1. ACC√âDER AU CLIENT\n  ‚Ä¢ Back-office ‚Üí Clients (/customers)\n  ‚Ä¢ Rechercher par nom/t√©l√©phone\n  ‚Ä¢ Ouvrir la fiche client\n\n‚úì 2. V√âRIFIER L'EMAIL\n  ‚Ä¢ Email bien orthographi√© ?\n  ‚Ä¢ Pas d'espace avant/apr√®s ?\n  ‚Ä¢ Format valide (contient @) ?\n  ‚Ä¢ Domaine valide (.com, .tn, etc.) ?\n\n‚úì 3. TESTER L'ENVOI\n  ‚Ä¢ Bouton 'Renvoyer email de confirmation'\n  ‚Ä¢ Demander au client de v√©rifier r√©ception\n  ‚Ä¢ V√©rifier bo√Æte normale ET spam\n\n‚ö†Ô∏è Erreurs courantes :\n‚Ä¢ Email mal saisi (typo, espace)\n‚Ä¢ Email sans @ ou domaine invalide\n‚Ä¢ Email temporaire/jetable bloqu√©\n‚Ä¢ Email d√©sactiv√©\n\nL'email du client est-il correct ? Format valide ?",
      "actions": [
        "verify_email_address",
        "resend_confirmation",
        "check_email_format"
      ],
      "success_indicator": "Email correctement form√©, client confirme avoir v√©rifi√© bo√Æte + spam",
      "time_estimate": "2-3 minutes",
      "step_id": "SOLVE_02_V_RIFIER_L_ADRESSE_5368A4"
    },
    {
      "kind": "solve",
      "title": "V√©rifier dans SPAM / Courrier ind√©sirable",
      "response": "Les emails TikTak PRO peuvent √™tre filtr√©s comme spam :\n\n‚úì DEMANDER AU CLIENT :\n  1. V√©rifier dossier SPAM / Courrier ind√©sirable\n  2. Chercher exp√©diteur: noreply@tiktak.space\n  3. Si trouv√©:\n     - Marquer comme 'Non spam' / 'Pas ind√©sirable'\n     - Ajouter noreply@tiktak.space aux contacts\n  4. V√©rifier √† nouveau bo√Æte de r√©ception\n\nüìß FOURNISSEURS EMAIL PROBL√âMATIQUES :\n‚Ä¢ Yahoo Mail: filtre tr√®s agressif\n‚Ä¢ Outlook/Hotmail: bloque parfois\n‚Ä¢ Orange/Free TN: configuration stricte\n‚Ä¢ Gmail: g√©n√©ralement OK mais v√©rifier \"Promotions\"\n\nüí° SOLUTION PERMANENTE :\n‚Ä¢ Whitelister noreply@tiktak.space\n‚Ä¢ Ajouter aux contacts\n‚Ä¢ Si probl√®me persiste: tester avec Gmail\n\nLe client a-t-il v√©rifi√© son dossier spam ? Quel fournisseur email ?",
      "actions": [
        "check_spam_folder",
        "whitelist_sender",
        "add_to_contacts",
        "suggest_gmail"
      ],
      "success_indicator": "Email trouv√© dans spam et marqu√© comme l√©gitime, ou fournisseur identifi√©",
      "common_fixes": [
        "V√©rifier spam avant tout",
        "Ajouter noreply@tiktak.space aux contacts",
        "Tester avec un autre email (Gmail)",
        "V√©rifier onglet Promotions (Gmail)"
      ],
      "troubleshooting": {
        "Email en spam syst√©matiquement": "Whitelister noreply@tiktak.space + ajouter aux contacts",
        "Aucun email (m√™me spam)": "V√©rifier validit√© email ou tester autre adresse",
        "Gmail onglet Promotions": "Normal, d√©placer vers Principal si souhait√©"
      },
      "step_id": "SOLVE_03_V_RIFIER_DANS_SPAM_5CF3E3"
    },
    {
      "kind": "solve",
      "title": "Configuration SMTP personnalis√©e (domaine custom)",
      "response": "Si vous utilisez un email personnalis√© (@votreentreprise.com) :\n\n‚úì CONFIGURATION SMTP DANS TIKTAKPRO :\n  1. Param√®tres ‚Üí Notifications / Email\n  2. Mode: SMTP personnalis√©\n  3. Renseigner :\n     ‚Ä¢ Serveur SMTP: smtp.votrefournisseur.com\n     ‚Ä¢ Port: 587 (TLS) ou 465 (SSL)\n     ‚Ä¢ Utilisateur: votre@email.com\n     ‚Ä¢ Mot de passe SMTP: (fourni par h√©bergeur)\n  4. Tester l'envoi\n\nüìß FOURNISSEURS SMTP TUNISIE :\n‚Ä¢ Topnet: smtp.topnet.tn (port 25 ou 587)\n‚Ä¢ Orange TN: smtp.orange.tn (port 587)\n‚Ä¢ GlobalNet: smtp.gnet.tn (port 587)\n‚Ä¢ Google Workspace: smtp.gmail.com (port 587)\n‚Ä¢ Office 365: smtp.office365.com (port 587)\n\n‚ö†Ô∏è ERREURS COURANTES :\n‚Ä¢ Connection refused ‚Üí V√©rifier firewall + port autoris√©\n‚Ä¢ Authentication failed ‚Üí V√©rifier username/password\n‚Ä¢ Relay denied ‚Üí Activer 'Allow relay' chez le fournisseur\n‚Ä¢ TLS error ‚Üí Changer de port (587 ‚Üî 465)\n\nQuel serveur SMTP utilisez-vous ? Port configur√© ?",
      "actions": [
        "configure_custom_smtp",
        "test_smtp_connection",
        "verify_smtp_credentials",
        "check_firewall_ports"
      ],
      "success_indicator": "Test SMTP r√©ussi, emails envoy√©s depuis domaine personnalis√©",
      "time_estimate": "10-15 minutes avec acc√®s aux credentials SMTP",
      "escalation_criteria": "SMTP configur√© correctement (credentials v√©rifi√©s) mais envoi √©choue",
      "step_id": "SOLVE_04_CONFIGURATION_SMTP_8AFC62"
    },
    {
      "kind": "solve",
      "title": "Templates email manquants ou cass√©s",
      "response": "Si les emails arrivent vides ou mal format√©s :\n\n‚úì V√âRIFIER TEMPLATES EMAIL :\n  1. Param√®tres ‚Üí Templates Email / Notifications\n  2. V√©rifier templates existants:\n     ‚Ä¢ Confirmation commande\n     ‚Ä¢ Exp√©dition / Tracking\n     ‚Ä¢ Annulation\n     ‚Ä¢ R√©initialisation mot de passe\n  3. Chaque template doit avoir:\n     ‚Ä¢ Sujet (non vide)\n     ‚Ä¢ Corps du message (non vide)\n     ‚Ä¢ Variables valides\n\n‚úì R√âINITIALISER SI CASS√â :\n  ‚Ä¢ Bouton 'Restaurer par d√©faut' sur le template\n  ‚Ä¢ Ou recr√©er le template manuellement\n\n‚úì VARIABLES DISPONIBLES :\n  ‚Ä¢ {{customer_name}} - Nom du client\n  ‚Ä¢ {{order_number}} - Num√©ro commande\n  ‚Ä¢ {{order_total}} - Montant total\n  ‚Ä¢ {{tracking_link}} - Lien suivi colis\n  ‚Ä¢ {{shop_name}} - Nom boutique\n  ‚Ä¢ {{order_date}} - Date commande\n\n‚úì TESTER :\n  ‚Ä¢ Cr√©er commande test\n  ‚Ä¢ V√©rifier email re√ßu\n  ‚Ä¢ Variables remplac√©es correctement ?\n\nLe template existe-t-il ? Variables correctes ?",
      "actions": [
        "check_email_templates",
        "reset_default_templates",
        "test_template_variables",
        "create_test_order"
      ],
      "success_indicator": "Template pr√©sent, variables valides, email re√ßu correctement format√©",
      "common_errors": [
        "Template vide ‚Üí Restaurer par d√©faut",
        "Variables non remplac√©es ‚Üí Syntaxe {{variable}}",
        "Sujet manquant ‚Üí Ajouter sujet au template"
      ],
      "step_id": "SOLVE_05_TEMPLATES_EMAIL_MA_78A2D6"
    },
    {
      "kind": "solve",
      "title": "Types d'emails et leurs d√©clencheurs",
      "response": "EMAILS AUTOMATIQUES TIKTAKPRO :\n\n1Ô∏è‚É£ CONFIRMATION COMMANDE\n   ‚Ä¢ Envoy√© √†: Client\n   ‚Ä¢ Quand: Cr√©ation commande (statut 'Confirm√©e')\n   ‚Ä¢ Contient: Num√©ro, produits, montant, adresse\n\n2Ô∏è‚É£ EXP√âDITION / TRACKING\n   ‚Ä¢ Envoy√© √†: Client\n   ‚Ä¢ Quand: Statut passe √† 'Exp√©di√©e'\n   ‚Ä¢ Contient: Num√©ro tracking, lien suivi\n\n3Ô∏è‚É£ ANNULATION\n   ‚Ä¢ Envoy√© √†: Client\n   ‚Ä¢ Quand: Statut passe √† 'Annul√©e'\n   ‚Ä¢ Contient: Raison annulation\n\n4Ô∏è‚É£ MOT DE PASSE\n   ‚Ä¢ Envoy√© √†: Client\n   ‚Ä¢ Quand: Demande r√©initialisation\n   ‚Ä¢ Contient: Lien s√©curis√©\n\n‚úì V√âRIFIER D√âCLENCHEUR :\n  ‚Ä¢ Email non re√ßu ‚Üí Statut commande correct ?\n  ‚Ä¢ Tracking non envoy√© ‚Üí Commande bien 'Exp√©di√©e' ?\n  ‚Ä¢ Annulation non envoy√©e ‚Üí Statut bien 'Annul√©e' ?\n\nQuel type d'email n'est pas re√ßu ? Statut de la commande ?",
      "actions": [
        "verify_order_status",
        "check_email_triggers",
        "manually_trigger_email"
      ],
      "success_indicator": "Statut correct, d√©clencheur identifi√©",
      "step_id": "SOLVE_06_TYPES_D_EMAILS_ET__A4FCAD"
    },
    {
      "kind": "solve",
      "title": "Aucun email re√ßu (v√©rifications avanc√©es)",
      "response": "Si AUCUN email n'arrive (ni normal ni spam) :\n\n‚úì 1. V√âRIFIER PARAM√àTRES GLOBAUX\n  ‚Ä¢ Param√®tres ‚Üí Notifications\n  ‚Ä¢ Envoi emails: Activ√© ?\n  ‚Ä¢ Adresse exp√©diteur configur√©e ?\n\n‚úì 2. TESTER AVEC AUTRE EMAIL\n  ‚Ä¢ Cr√©er commande test avec Gmail\n  ‚Ä¢ V√©rifier r√©ception ‚Üí isole si probl√®me client\n\n‚úì 3. V√âRIFIER LOGS (si acc√®s admin)\n  ‚Ä¢ Param√®tres ‚Üí Logs / Historique\n  ‚Ä¢ Rechercher envois email\n  ‚Ä¢ Erreurs SMTP ?\n\n‚úì 4. QUOTA / LIMITES\n  ‚Ä¢ Certains fournisseurs: limite envois/jour\n  ‚Ä¢ V√©rifier quota chez fournisseur SMTP\n  ‚Ä¢ Attendre 24h si quota atteint\n\n‚ö†Ô∏è CAUSES RARES :\n‚Ä¢ Domaine blacklist√© (liste noire spam)\n‚Ä¢ IP serveur bloqu√©e\n‚Ä¢ DNS SPF/DKIM mal configur√©\n‚Ä¢ Service email TikTak temporairement down\n\nTous les clients concern√©s ou juste certains ?",
      "actions": [
        "verify_global_settings",
        "test_with_different_email",
        "check_smtp_logs",
        "verify_email_quota"
      ],
      "success_indicator": "Cause identifi√©e (settings, quota, ou incident global)",
      "escalation_criteria": "Emails activ√©s, SMTP OK, test autres emails OK, mais client sp√©cifique ne re√ßoit rien",
      "step_id": "SOLVE_07_AUCUN_EMAIL_RE_U_V_F82DC5"
    },
    {
      "kind": "verify",
      "question": "Apr√®s ces v√©rifications, le client re√ßoit-il maintenant les emails ? Si non, fournissez : type email attendu, adresse email exacte (caviard√©e si sensible), fournisseur email, r√©sultat test spam.",
      "step_id": "VERIFY_08_APR_S_CES_V_RIFICA_6BB58E"
    },
    {
      "kind": "escalate",
      "reason": "Configuration email v√©rifi√©e (adresse valide, SMTP OK, templates pr√©sents) mais emails non re√ßus, ou probl√®me infrastructure (IP blacklist√©e, SPF/DKIM, serveur email down)",
      "required_info": [
        "Type d'email concern√© (commande/exp√©dition/password)",
        "Adresse email du client (derniers caract√®res suffisent)",
        "Fournisseur email client (Gmail/Yahoo/Outlook/Orange/etc)",
        "R√©sultat v√©rification spam (trouv√©/pas trouv√©)",
        "Mode SMTP (d√©faut TikTak ou personnalis√©)",
        "Si personnalis√©: fournisseur SMTP utilis√©",
        "Tous clients affect√©s ou un seul ?",
        "Capture √©cran config SMTP (si personnalis√©)"
      ],
      "step_id": "ESCALATE_09_ESCALATE_1A3A71",
      "when": [
        "needs_human_review"
      ],
      "handoff_template": {
        "summary": "Configuration email v√©rifi√©e (adresse valide, SMTP OK, templates pr√©sents) mais emails non re√ßus, ou probl√®me infrastructure (IP blacklist√©e, SPF/DKIM, serveur email down)",
        "repro_steps": [],
        "evidence": [
          "Type d'email concern√© (commande/exp√©dition/password)",
          "Adresse email du client (derniers caract√®res suffisent)",
          "Fournisseur email client (Gmail/Yahoo/Outlook/Orange/etc)",
          "R√©sultat v√©rification spam (trouv√©/pas trouv√©)",
          "Mode SMTP (d√©faut TikTak ou personnalis√©)",
          "Si personnalis√©: fournisseur SMTP utilis√©",
          "Tous clients affect√©s ou un seul ?",
          "Capture √©cran config SMTP (si personnalis√©)"
        ],
        "suspected_component": "settings",
        "priority": "P2"
      }
    }
  ],
  "related_docs": [
    "/settings - Configuration SMTP et templates email",
    "/customers - Gestion adresses email clients"
  ],
  "best_practices": [
    "Toujours v√©rifier spam AVANT d'escalader",
    "Ajouter noreply@tiktak.space aux contacts",
    "Tester avec Gmail si doute sur fournisseur client",
    "V√©rifier format email avant de sauvegarder",
    "Pour SMTP personnalis√©: noter les credentials en lieu s√ªr",
    "Tester envoi apr√®s chaque changement config"
  ],
  "common_errors": [
    {
      "symptom": "Email syst√©matiquement en spam",
      "cause": "Domaine TikTak pas en whitelist chez le client",
      "solution": "Client ajoute noreply@tiktak.space aux contacts et marque comme non spam"
    },
    {
      "symptom": "Aucun email re√ßu (m√™me spam)",
      "cause": "Email invalide, d√©sactiv√©, ou fournisseur bloque",
      "solution": "V√©rifier format email, tester avec autre adresse (Gmail)"
    },
    {
      "symptom": "Email vide ou variables non remplac√©es",
      "cause": "Template cass√© ou syntaxe variables incorrecte",
      "solution": "Restaurer template par d√©faut, v√©rifier syntaxe {{variable}}"
    },
    {
      "symptom": "SMTP Connection refused",
      "cause": "Port bloqu√© ou serveur SMTP incorrect",
      "solution": "V√©rifier port (587 vs 465), tester autre port, v√©rifier firewall"
    }
  ],
  "canonical_scope": "notifications",
  "required_fields": [
    {
      "key": "email_type",
      "question": "Quel type d'email n'est pas re√ßu (commande / exp√©dition / mot de passe) ?"
    },
    {
      "key": "customer_email",
      "question": "Quelle est l'adresse email du client ?"
    },
    {
      "key": "spam_checked",
      "question": "Le client a-t-il v√©rifi√© son dossier spam ?"
    }
  ],
  "schema_version": "v2_deterministic_steps"
}